{
  "topic": "architecture.principles",
  "title": "Design Principles",
  "description": "Five core principles of MathHook in strict priority order: mathematical correctness,\nperformance, ergonomic API, educational value, and multi-language support.\n",
  "code_refs": {
    "rust": "mathhook_core"
  },
  "article": {
    "content": "# Design Principles\n\nMathHook is built on five core principles, listed in strict priority order.\n\n## 1. Mathematical Correctness First\n\n**This is the absolute highest priority. All other principles are secondary.**\n\nEvery mathematical operation in MathHook must be correct in ALL cases:\n\n- Equation solving handles all valid cases correctly\n- Simplification preserves mathematical equivalence\n- Domain restrictions are respected (sqrt, log, division by zero)\n- Symbolic operations maintain algebraic properties\n\n### Zero Tolerance for Regressions\n\nAny modification that breaks existing correct functionality is an unacceptable failure.\n\n### Validation Against References\n\n- **SymPy** (`~/Documents/work/math/sympy/`): Primary validation reference\n\n## 2. Performance\n\nAfter correctness, performance is the next priority.\n\n### 32-Byte Expression Constraint\n\nExpressions are exactly 32 bytes to fit two expressions per 64-byte cache line (standard on modern CPUs). This constraint:\n\n- Enables efficient memory access patterns\n- Improves CPU cache utilization\n- Provides 10-100x speedup over Python-based systems\n\n### Zero-Copy Parsing\n\nParse strings directly into AST without intermediate allocations.\n\n### SIMD Operations\n\nVectorized operations for bulk arithmetic provide 2-4x speedup:\n\n```rust\n# extern crate mathhook_book;\n# use mathhook_book::mathhook;\n# use mathhook::prelude::*;\n// SIMD automatically used for arrays > 100 elements\nlet values = vec![1.0, 2.0, 3.0, /* ... many values */];\nlet sum = simd_bulk_add_numeric(&values);\n```\n\n### Thread Safety\n\nImmutable expressions enable parallel processing without locks:\n\n```rust\n# extern crate mathhook_book;\n# use mathhook_book::mathhook;\n# use mathhook::prelude::*;\nlet expressions = vec![/* many expressions */];\nlet simplified = parallel_bulk_simplify(&expressions);\n```\n\n## 3. Ergonomic API\n\nMathHook provides natural, intuitive APIs.\n\n### Macros for Clarity\n\n```rust\n# extern crate mathhook_book;\n# use mathhook_book::mathhook;\n# use mathhook::prelude::*;\n// Clean and readable\nlet expr = expr!((x ^ 2) + (2 * x) + 1);\n\n// vs verbose API\nlet expr = expr!((x ^ 2) + (2 * x) + 1);\n```\n\n### Operator Overloading\n\n```rust\n# extern crate mathhook_book;\n# use mathhook_book::mathhook;\n# use mathhook::prelude::*;\nlet x = symbol!(x);\nlet y = symbol!(y);\n\n// Natural arithmetic\nlet sum = x + y;\nlet product = x * y;\n```\n\n## 4. Educational Value\n\nMathHook provides step-by-step explanations for all operations.\n\n```rust\n# extern crate mathhook_book;\n# use mathhook_book::mathhook;\n# use mathhook::prelude::*;\nlet explanation = expr.explain_simplification();\n\nfor step in explanation.steps() {\n    println!(\"{}: {}\", step.title, step.description);\n}\n```\n\nThis makes MathHook ideal for:\n\n- Educational software\n- Learning platforms\n- Interactive mathematics tools\n- Automated tutoring systems\n\n## 5. Multi-Language Support\n\nMathHook provides first-class bindings for multiple languages:\n\n- **Rust** (native)\n- **Python** (via PyO3)\n- **Node.js/TypeScript** (via NAPI-RS)\n- **WebAssembly** (coming soon)\n\nAll bindings maintain the same correctness and performance guarantees.\n\n## Architectural Constraints\n\n### Type System Constraints\n\nThese are non-negotiable:\n\n- **Expression**: 32 bytes (cache-line optimization)\n- **Number**: 16 bytes (fits in Expression)\n- **Symbol**: String interning for O(1) equality\n\n### Immutability\n\nAll expressions are immutable after creation. This enables:\n\n- Thread-safe sharing\n- Reliable caching\n- Predictable behavior\n\n### Canonical Forms\n\nExpressions maintain canonical forms automatically:\n\n- Commutative operations sorted\n- Associativity flattened\n- Identity elements eliminated\n- Rationals reduced\n"
  },
  "related_topics": [
    "architecture.type-system",
    "architecture.function-intelligence",
    "architecture.memory-layout",
    "architecture.thread-safety"
  ],
  "metadata": {
    "schema_version": "1.0"
  }
}