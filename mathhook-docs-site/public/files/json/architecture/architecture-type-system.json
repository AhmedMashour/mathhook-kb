{
  "topic": "architecture.type-system",
  "title": "Type System",
  "description": "MathHook's type system design and constraints. Covers Expression, Number, and Symbol types\nwith their memory layout and performance characteristics.\n",
  "code_refs": {
    "rust": "mathhook_core::Expression"
  },
  "article": {
    "content": "# Type System\n\nThis chapter covers internal implementation details of MathHook's type system.\n\n## Core Types\n\n- **Expression**: 32-byte AST node (cache-optimized)\n- **Number**: 16-byte tagged union (integer/rational/float/complex)\n- **Symbol**: String interning for O(1) equality\n\n## Type Constraints\n\n### Expression Constraint\n\nExpressions are exactly 32 bytes to fit two expressions per 64-byte cache line.\nThis is a non-negotiable architectural constraint that provides:\n\n- Efficient memory access patterns\n- Improved CPU cache utilization\n- 10-100x speedup over Python-based systems\n\n### Number Constraint\n\nNumbers are 16 bytes to fit within the Expression type. The tagged union supports:\n\n- Integer (arbitrary precision via pointer to heap)\n- Rational (numerator/denominator pair)\n- Float (f64)\n- Complex (two f64s)\n\n### Symbol Interning\n\nSymbols use string interning for O(1) equality comparisons:\n\n- First occurrence allocates and stores in global table\n- Subsequent uses return pointer to existing string\n- Equality is pointer comparison (no string comparison needed)\n\n## Type Safety\n\nMathHook's type system provides:\n\n- **Compile-time safety**: Types checked at compile time\n- **Mathematical correctness**: Operations preserve mathematical properties\n- **Domain enforcement**: Domain restrictions respected (sqrt, log, division by zero)\n"
  },
  "related_topics": [
    "architecture.principles",
    "architecture.memory-layout",
    "architecture.crate-structure"
  ],
  "metadata": {
    "schema_version": "1.0"
  }
}